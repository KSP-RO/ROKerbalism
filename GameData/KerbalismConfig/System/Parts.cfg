
// SOURCES

// NTRS - https://ntrs.nasa.gov/archive/nasa/casi.ntrs.nasa.gov/20090029327.pdf


// ==============================================================================
// Add predetermined Life Support to parts
// ==============================================================================

//Aviation
@PART[SXTBuzzard|SXTmk3Cockpit52|SXTke111|25mKossak|SXTClyde|625mBonny|SXTmeadowlark|SXTEntenteCordiale|SXTGoose|SXTOsaulNoseCockpitAn225|RP0Nose-Cockpit|X1_Crew|Mark1Cockpit|RO-X1Cockpit]:NEEDS[ProfileRealismOverhaul]:AFTER[RealismOverhaul]
{
  processConfigureExclude = true
  MODULE
  {
    name = ProcessController
    resource = _AirPump
    title = Air Pump
    capacity = #$/CrewCapacity$
    running = true
  }
}

// X-15. rp-1 makes it 'rated for very gentle reentry from LEO, so it should
// have enough of a scrubber to actually go to orbit and back - but not so much
// as to compete with Mercury for longevity.
// Not historical, but not technically challenging, rebreather tech was already
// well established.
@PART[Mark1Cockpit,Mark2Cockpit]:NEEDS[ProfileRealismOverhaul]:AFTER[RealismOverhaul]
{

  @MODULE[ModuleCommand]
  {
    @RESOURCE[ElectricCharge]
    {
      @rate = 1.520  //Remove Climatization and LS power draw
    }
  }
  // uses an EVA scrubber because x-15's life support was just a rudimentary
  // suit so it's assumed to have a small airflow and be very simple
  MODULE
  {
    name = ProcessController
    resource = _EVAScrubber
    title = Scrubber
    capacity = 1.1
    toggle = true
    running = true
  }
  MODULE
  {
    name = ProcessController
    resource = _PressureControlOxygen
    title = O2 Pressure Controller
    capacity = 1.1
    running = true
  }

  @MODULE[ProcessController],*
  {
    @capacity *= #$/CrewCapacity$
  }

  processConfigureExclude = true
  MODULE
  {
    name = Configure
    title = Suit Life Support
    slots = 2
    
    SETUP
    {
      name = LiOH Scrubber
      desc = A simple scrubber that sequesters <b>CarbonDioxide</b> from the internal atmosphere. <b>WARNING: Only lasts 8 hours!</b>
      tech = crewSurvivability
      
      MODULE
      {
        type = ProcessController
        id_field = resource
        id_value = _EVAScrubber
      }
    }
    SETUP
    {
      name = O2 Pressure Controller
      desc = Use <b>Oxygen</b> to maintain the internal atmosphere at a comfortable pressure.
      tech = crewSurvivability
      
      MODULE
      {
        type = ProcessController
        id_field = resource
        id_value = _PressureControlOxygen
      }
    }
  }  
}

//Mercury
@PART[ROC-MercuryCM|ROC-MercuryCMBDB|FASAMercuryPod|mk1pod|mk1pod_v2]:NEEDS[ProfileRealismOverhaul]:AFTER[RealismOverhaul]
{
  %capsuleScrubbers = true
  %scrubberCapacity = 1.1
  %capsuleOrigin = US

  @MODULE[ModuleCommand]
  {
    @RESOURCE[ElectricCharge]
    {
      @rate = 0.475  //Remove Climatization and LS power draw
    }
  }
  MODULE
  {
    name = ProcessController
    resource = _PressureControlOxygen
    title = O2 Pressure Controller
    desc = Use <b>Oxygen</b> to maintain the internal atmosphere at a comfortable pressure.
    capacity = 1
    toggle = true
    running = true
  }

  @MODULE[ProcessController],*
  {
    @capacity *= #$/CrewCapacity$
  }
}

//Vostok/Voskhod
@PART[kv3Pod|ROC-VostokCapsule|ROC-VoskhodCapsule|rn_vostok_sc|rn_voskhod_sc]:NEEDS[ProfileRealismOverhaul]:AFTER[RealismOverhaul]
{
  %capsuleScrubbers = true
  %scrubberCapacity = 1.2
  %capsuleOrigin = USSR

  @MODULE[ModuleCommand]
  {
    @RESOURCE[ElectricCharge]
    {
      @rate = 0.214  //Remove Climatization and LS power draw
    }
  }

  MODULE
  {
    name = ProcessController
    resource = _PressureControl
    title = N2 Pressure Controller
    desc =  Use <b>Nitrogen</b> to maintain the internal atmosphere at a comfortable pressure.
    capacity = 1
    toggle = true
    running = true
  }
  
  @MODULE[ProcessController],*
  {
    @capacity *= #$/CrewCapacity$
  }

  processConfigureExclude = true
  MODULE
  {
    name = Configure
    title = Processes
    slots = 1

    SETUP
    {
      name = N2 Pressure Controller
      desc = Use <b>Nitrogen</b> to maintain the internal atmosphere at a comfortable pressure.
      tech = crewSurvivability
            
      MODULE
      {
        type = ProcessController
        id_field = resource
        id_value = _PressureControl
      }
    }
  }
}

//Soyuz
//Descent module
@PART[rn_zond_sa|ok_sa|rn_lok_sa|SSTU-SC-A-DM]:NEEDS[ProfileRealismOverhaul]:AFTER[RealismOverhaul]
{
  %capsuleScrubbers = true
  %scrubberCapacity = 1.1
  %capsuleOrigin = USSR

  @MODULE[ModuleCommand]
  {
    @RESOURCE[ElectricCharge]
    {
      @rate = 0.650  //Remove Climatization and LS power draw
    }
  }

  @MODULE[ProcessController],*
  {
    @capacity *= #$/CrewCapacity$
  }
}
//Orbital module
@PART[TIorbitalorb|rn_lok_bo|tg_bo|ok_bo_fem|ok_bo_male|t_af_bo|t_bo|t_bo2|rn_astp_bo|SSTU-SC-A-OM]:NEEDS[ProfileRealismOverhaul]:AFTER[RealismOverhaul]
{
  %capsuleScrubbers = true
  // don't add the generic scrubbers since the main ones are in the descent module

  MODULE
  {
    name = ProcessController
    resource = _Scrubber
    title = LiOH Scrubber (Auxiliary)
    capacity = 0.2
    desc =  A Lithium Hydroxide scrubber. <b>Only absorbs 20% of the CO2 produced by the crew!</b>
    toggle = true
    running = true
  }

  MODULE
  {
    name = ProcessController
    resource = _PressureControl
    title = N2 Pressure Controller
    capacity = 1.1
    desc = Use <b>Nitrogen</b> to maintain the internal atmosphere at a comfortable pressure.
    toggle = true
    running = true
  }

  @MODULE[ProcessController],*
  {
    @capacity *= #$/CrewCapacity$
  }
}

//Lunar Soyuz SM
@PART[rn_lok_tdu]:NEEDS[ProfileRealismOverhaul]:AFTER[RealismOverhaul]
{
	MODULE
	{
		name = ProcessController
		resource = _FuelCell
		title = Fuel Cells 
		capacity = 1.5
		toggle = true
		running = true
	}
	MODULE
	{
		name = Configure
		title = Service Module
		slots = 1

		SETUP
		{
			name = Fuel Cells
			desc = 1.5 kW fuel cell unit that consumes <b>LqdHydrogen</b> and <b>LqdOxygen</b> to generate <b>Water</b>.
			tech = lunarRatedPower

			MODULE
			{
				type = ProcessController
				id_field = resource
				id_value = _FuelCell
			}
		}
	}
}

//Gemini
@PART[Mk2Pod|FASAGeminiPod2|FASAGeminiPod2White|ROAdvCapsule|ROC-GeminiCM|ROC-GeminiCMBDB|ROC-GeminiLCMBDB]:NEEDS[ProfileRealismOverhaul]:AFTER[RealismOverhaul]
{
  %capsuleScrubbers = true
  %scrubberCapacity = 1.3
  %capsuleOrigin = US

  @MODULE[ModuleCommand]
  {
    @RESOURCE[ElectricCharge]
    {
      @rate = 1.900  //Remove Climatization and LS power draw
    }
  }
}

//Dynasoar
@PART[ROC-DynaBody|ROC-DynaButtMoroz]:NEEDS[ProfileRealismOverhaul]:AFTER[RealismOverhaul]
{
  MODULE
  {
    name = ProcessController
    resource = _FuelCell
    title = Fuel Cells
    capacity = 4
    running = true
  }
  MODULE
  {
    name = ProcessController
    resource = _LOXConverter
    title = LOX to GOX Converter
    capacity = 3
  }
  MODULE
  {
    name = ProcessController
    resource = _PressureControl
    title = N2 Pressure Controller
    capacity = 3
    running = true
  }

  processConfigureExclude = true
  MODULE
  {
    name = Configure
    title = Processes
    slots = 3

    SETUP
    {
      name = Fuel Cells
      desc = 4 kW fuel cell unit that consumes <b>LqdHydrogen</b> and <b>LqdOxygen</b> to generate <b>Water</b>.
      tech = improvedPower

      MODULE
      {
        type = ProcessController
        id_field = resource
        id_value = _FuelCell
      }
    }

    SETUP
    {
      name = LOX to GOX Converter
      desc = Heats <b>LqdOxygen</b> to breathable <b>Oxygen</b>.
      tech = earlyLifeSupport

      MODULE
      {
        type = ProcessController
        id_field = resource
        id_value = _LOXConverter
      }
    }

    SETUP
    {
      name = N2 Pressure Controller
      desc = Use <b>Nitrogen</b> to maintain the internal atmosphere at a comfortable pressure.
      tech = crewSurvivability
            
      MODULE
      {
        type = ProcessController
        id_field = resource
        id_value = _PressureControl
      }
    }
  }
}

//Remove Climatization and LS power draw
@PART[ROC-DynaBody|ROC-DynaCockpitMoroz]:NEEDS[ProfileRealismOverhaul]:AFTER[RealismOverhaul]
{
  @MODULE[ModuleCommand]
  {
    @RESOURCE[ElectricCharge]
    {
      @rate = 1.785  //Remove Climatization and LS power draw
    }
  }
}

//Add scrubbers
@PART[ROC-DynaBody|ROC-DynaCabin|ROC-DynaCockpitMoroz|ROC-DynaCabinMoroz]:NEEDS[ProfileRealismOverhaul]:AFTER[RealismOverhaul]
{
  %capsuleScrubbers = true
  %scrubberCapacity = 1.3
  %capsuleOrigin = US
}

//Early Spaceplanes
@PART[RO-Mk1Cockpit|RO-Mk1CockpitInline|MK1CrewCabin]:NEEDS[ProfileRealismOverhaul]:AFTER[RealismOverhaul]
{
  %capsuleScrubbers = true
  %scrubberCapacity = 1.3
  %capsuleOrigin = US

  @MODULE[ModuleCommand]
  {
    @RESOURCE[ElectricCharge]
    {
      @rate = 0.360  //Remove Climatization and LS power draw
    }
  }

  MODULE
  {
    name = ProcessController
    resource = _AirPump
    title = Air Pump
    capacity = 1
    running = true
  }

  MODULE
  {
    name = ProcessController
    resource = _PressureControlOxygen
    title = O2 Pressure Controller
    desc = Use <b>Oxygen</b> to maintain the internal atmosphere at a comfortable pressure.
    capacity = 1
    running = true
  }

  @MODULE[ProcessController],*
  {
    @capacity *= #$/CrewCapacity$
  }
}

//Big Gemini
@PART[FASAGeminiBigG|FASAGeminiBigGWhite|ROC-BigGeminiCabinBDB]:NEEDS[ProfileRealismOverhaul]:AFTER[RealismOverhaul]
{
  %capsuleScrubbers = true
  %scrubberCapacity = 1.2
  %capsuleOrigin = US

  MODULE
  {
    name = ProcessController
    resource = _PressureControlOxygen
    title = O2 Pressure Controller
    desc = Use <b>Oxygen</b> to maintain the internal atmosphere at a comfortable pressure.
    capacity = 2
    running = true
    toggle = true
  }

  @MODULE[ProcessController],*
  {
    @capacity *= #$/CrewCapacity$
  }
}

//ROC Big Gemini SM
@PART[ROC-BigGeminiSM]:NEEDS[ProfileRealismOverhaul]:AFTER[RealismOverhaul]
{
  MODULE
  {
    name = ProcessController
    resource = _FuelCell
    title = Fuel Cells 
    capacity = 4.26
    toggle = true
    running = true
  }

  MODULE
  {
    name = ProcessController
    resource = _LOXConverter
    title = LOX to GOX Converter
    capacity = 9
  }

  processConfigureExclude = true
  MODULE
  {
    name = Configure
    title = Processes
    slots = 2

    SETUP
    {
      name = Fuel Cells
      desc = 4.26 kW fuel cell unit that consumes <b>LqdHydrogen</b> and <b>LqdOxygen</b> to generate <b>Water</b>.
      tech = lunarRatedPower

      MODULE
      {
        type = ProcessController
        id_field = resource
        id_value = _FuelCell
      }
    }

    SETUP
    {
      name = LOX to GOX Converter
      desc = Heats <b>LqdOxygen</b> to breathable <b>Oxygen</b>.
      tech = earlyLifeSupport

      MODULE
      {
        type = ProcessController
        id_field = resource
        id_value = _LOXConverter
      }
    }
  }
}

//Early Landers
@PART[landerCabinSmall|FASA_Gemini_Lander_Pod]:NEEDS[ProfileRealismOverhaul]:AFTER[RealismOverhaul]
{
  %capsuleScrubbers = true
  %scrubberCapacity = 1.1
  %capsuleOrigin = US

  @MODULE[ModuleCommand]
  {
    @RESOURCE[ElectricCharge]
    {
      @rate = 0.327  //Remove Climatization and LS power draw
    }
  }
}
//Gemini SM
@PART[ROC-GeminiEquipmentSection|ROC-GeminiEquipmentSectionBDB|FASAGeminiUtilityPack]:NEEDS[ProfileRealismOverhaul]:AFTER[RealismOverhaul]
{
  MODULE
  {
    name = ProcessController
    resource = _FuelCell
    title = Fuel Cells
    capacity = 2.2
    toggle = true
    running = true
  }
  MODULE
  {
    name = ProcessController
    resource = _LOXConverter
    title = LOX to GOX Converter
    capacity = 1.2 // 0.55 per crew member + margin
  }
  MODULE
  {
    name = ProcessController
    resource = _PressureControlOxygen
    title = O2 Pressure Controller
    capacity = 2
    running = true
  }

  processConfigureExclude = true
  MODULE
  {
    name = Configure
    title = Processes
    slots = 3
    
    SETUP
    {
      name = O2 Pressure Controller
      desc = Use <b>Oxygen</b> to maintain the internal atmosphere at a comfortable pressure.
      tech = crewSurvivability
            
      MODULE
      {
        type = ProcessController
        id_field = resource
        id_value = _PressureControlOxygen
      }
    }
    SETUP
    {
      name = Fuel Cell
      desc = A fuel cell that combines <b>Liquid Hydrogen</b> and <b>Liquid Oxygen</b>, producing <b>Water</b> as a by-product.
      tech = improvedPower

      MODULE
      {
        type = ProcessController
        id_field = resource
        id_value = _FuelCell
      }
    }
    SETUP
    {
      name = LOX to GOX Converter
      desc = Heats <b>LqdOxygen</b> to breathable <b>Oxygen</b>.
      tech = earlyLifeSupport

      MODULE
      {
        type = ProcessController
        id_field = resource
        id_value = _LOXConverter
      }
    }
  }
}

// Apollo D2
// CM, MM1, MM2
@PART[ROC-D2CM|ROC-D2MissionModule1|ROC-D2MissionModule2]:NEEDS[ProfileRealismOverhaul]:AFTER[RealismOverhaul]
{
  %capsuleScrubbers = true
  %scrubberCapacity = 1.67
  %capsuleOrigin = US

  @MODULE[ModuleCommand]
  {
    @RESOURCE[ElectricCharge]
    {
      @rate = 1.65  //Remove Climatization and LS power draw
    }
  }
}

// Apollo D2 SM
@PART[ROC-D2ServiceModule]:NEEDS[ProfileRealismOverhaul]:AFTER[RealismOverhaul]
{
  MODULE
  {
    name = ProcessController
    resource = _FuelCell
    title = Fuel Cells 
    capacity = 2.5
    running = true
  }
  MODULE
  {
    name = ProcessController
    resource = _LOXConverter
    title = LOX to GOX Converter
    capacity = 3
  }
  MODULE
  {
    name = ProcessController
    resource = _PressureControlOxygen
    title = O2 Pressure Controller
    capacity = 5
    running = true
  }

  processConfigureExclude = true
  MODULE
  {
    name = Configure
    title = Processes
    slots = 3

    SETUP
    {
      name = O2 Pressure Controller
      desc = Use <b>Oxygen</b> to maintain the internal atmosphere at a comfortable pressure.
      tech = crewSurvivability
            
      MODULE
      {
        type = ProcessController
        id_field = resource
        id_value = _PressureControlOxygen
      }
    }

    SETUP
    {
      name = Fuel Cells
      desc = 3 kW fuel cell unit that consumes <b>LqdHydrogen</b> and <b>LqdOxygen</b> to generate <b>Water</b>.
      tech = improvedPower
            
      MODULE
      {
        type = ProcessController
        id_field = resource
        id_value = _FuelCell
      }
    }

    SETUP
    {
      name = LOX to GOX Converter
      desc = Heats <b>LqdOxygen</b> to breathable <b>Oxygen</b>.
      tech = earlyLifeSupport
            
      MODULE
      {
        type = ProcessController
        id_field = resource
        id_value = _LOXConverter
      }
    }
  }
}

//Apollo
@PART[APOLLO_CM|FASAApollo_CM|bluedog_Apollo_Block2_Capsule|ROC-ApolloCM|ROC-ApolloCMBDB|SSTU-SC-B-CM|SSTU-SC-B-CMX|mk1-3pod]:NEEDS[ProfileRealismOverhaul]:AFTER[RealismOverhaul]
{
  %capsuleScrubbers = true
  %scrubberCapacity = 1.67
  %capsuleOrigin = US

  @MODULE[ModuleCommand]
  {
    @RESOURCE[ElectricCharge]
    {
      @rate = 1.520  //Remove Climatization and LS power draw
    }
  }
}
//Apollo SM
@PART[APOLLO_SM|FASAApollo_SM|bluedog_Apollo_Block2_ServiceModule|ROC-ApolloSM|ROC-ApolloSMB2BDB]:NEEDS[ProfileRealismOverhaul]:AFTER[RealismOverhaul]
{
  MODULE
  {
    name = ProcessController
    resource = _FuelCell
    title = Fuel Cells 
    capacity = 4.26
    running = true
  }
  MODULE
  {
    name = ProcessController
    resource = _LOXConverter
    title = LOX to GOX Converter
    capacity = 3
  }
  MODULE
  {
    name = ProcessController
    resource = _PressureControlOxygen
    title = O2 Pressure Controller
    capacity = 5
    running = true
  }

  processConfigureExclude = true
  MODULE
  {
    name = Configure
    title = Processes
    slots = 3

    SETUP
    {
      name = O2 Pressure Controller
      desc = Use <b>Oxygen</b> to maintain the internal atmosphere at a comfortable pressure.
      tech = crewSurvivability
            
      MODULE
      {
        type = ProcessController
        id_field = resource
        id_value = _PressureControlOxygen
      }
    }

    SETUP
    {
      name = Fuel Cells
      desc = 4.26 kW fuel cell unit that consumes <b>LqdHydrogen</b> and <b>LqdOxygen</b> to generate <b>Water</b>.
      tech = lunarRatedPower
            
      MODULE
      {
        type = ProcessController
        id_field = resource
        id_value = _FuelCell
      }
    }

    SETUP
    {
      name = LOX to GOX Converter
      desc = Heats <b>LqdOxygen</b> to breathable <b>Oxygen</b>.
      tech = earlyLifeSupport
            
      MODULE
      {
        type = ProcessController
        id_field = resource
        id_value = _LOXConverter
      }
    }
  }
}
//Landers
@PART[ROC-LEMAscent|ROC-LEMAscentBDB|LEM_ASCENT_STAGE|FASALM_AscentStage|bluedog_LEM_Ascent_Cockpit|landerCabinMedium|mk2LanderCan|mk2LanderCabin_v2|SXTLander|SSTU-LC2-POD|rn_lk_lander]:NEEDS[ProfileRealismOverhaul]:AFTER[RealismOverhaul]
{
  %capsuleScrubbers = true
  %scrubberCapacity = 1.67
  %capsuleOrigin = US

  @MODULE[ModuleCommand]
  {
    @RESOURCE[ElectricCharge]
    {
      @rate -= 0.2  //Remove Climatization and LS power draw
    }
  }
}
//Spaceplanes
@PART[mk2Cockpit_Inline|mk2Cockpit_Standard|mk2CrewCabin]:NEEDS[ProfileRealismOverhaul]:AFTER[RealismOverhaul]
{
  %capsuleScrubbers = true
  %scrubberCapacity = 1.1
  %capsuleOrigin = US

  MODULE
  {
    name = ProcessController
    resource = _AirPump
    title = Air Pump
    capacity = 1
    running = true
  }

  MODULE
  {
    name = ProcessController
    resource = _PressureControlOxygen
    title = O2 Pressure Controller
    desc = Use <b>Oxygen</b> to maintain the internal atmosphere at a comfortable pressure.
    capacity = 1.67
    running = true
  }
  
  @MODULE[ProcessController],*
  {
    @capacity *= #$/CrewCapacity$
  }
}
//Apollo Block III
@PART[bluedog_Apollo_Block3_Capsule|ROC-ApolloCMBlockIII|ROC-ApolloCMBDBBlockIII]:NEEDS[ProfileRealismOverhaul]:AFTER[RealismOverhaul]
{
  %capsuleScrubbers = true
  %scrubberCapacity = 1.67
  %capsuleOrigin = US

  @MODULE[ModuleCommand]
  {
    @RESOURCE[ElectricCharge]
    {
      @rate -= 0.400  //Remove Climatization and LS power draw
    }
  }
}

//Apollo BlockIII+ SM
@PART[ROC-ApolloSMBlockIII|ROC-ApolloSMDBDBlockIV]:NEEDS[ProfileRealismOverhaul]:AFTER[RealismOverhaul]
{
  MODULE
  {
    name = ProcessController
    resource = _PressureControl
    title = N2 Pressure Controller
    desc = Use <b>Nitrogen</b> to maintain the internal atmosphere at a comfortable pressure.
    capacity = 5
    toggle = true
    running = true
  }

  processConfigureExclude = true
  MODULE
  {
    name = Configure
    title = Processes
    slots = 1

    SETUP
    {
      name = N2 Pressure Control
      desc = Use <b>Nitrogen</b> to maintain the internal atmosphere at a comfortable pressure.
      tech = earlyLifeSupport

      MODULE
      {
        type = ProcessController
        id_field = resource
        id_value = _PressureControl
      }
    }
  }
}

//VA capsule
@PART[MK2VApod|rn_va_capsule|SSTU-SC-V-CM]:NEEDS[ProfileRealismOverhaul]:AFTER[RealismOverhaul]
{
  %capsuleScrubbers = true
  %scrubberCapacity = 1.2
  %capsuleOrigin = USSR

  @MODULE[ModuleCommand]
  {
    @RESOURCE[ElectricCharge]
    {
      @rate = 1.500  //Remove Climatization and LS power draw
    }
  }

  MODULE
  {
    name = ProcessController
    resource = _PressureControl
    title = N2 Pressure Controller
    desc = Use <b>Nitrogen</b> to maintain the internal atmosphere at a comfortable pressure.
    capacity = 1
    toggle = true
    running = true
  }

  @MODULE[ProcessController],*
  {
    @capacity *= #$/CrewCapacity$
  }
}
//TKS FGB
@PART[rn_tks]:NEEDS[ProfileRealismOverhaul]:AFTER[RealismOverhaul]
{
  %capsuleScrubbers = true
  %scrubberCapacity = 3
  %capsuleOrigin = USSR

  MODULE
  {
    name = ProcessController
    resource = _PressureControl
    title = N2 Pressure Controller
    desc = Use <b>Nitrogen</b> to maintain the internal atmosphere at a comfortable pressure.
    capacity = 3
    toggle = true
    running = true
  }

  @MODULE[ProcessController],*
  {
    @capacity *= 1.3
  }
}

//Shuttle
//Add fuel cells for Mk3 in another patch below since SOCK places the fuel cells in another part
@PART[mk3Cockpit_Shuttle|benjee10_shuttle_forwardFuselage|Space_Shuttle_Crew|Space_Shuttle_Crew_Analog|ShuttleCabin|BURAN_CABINE]:NEEDS[ProfileRealismOverhaul]:AFTER[RealismOverhaul]
{
  %capsuleScrubbers = true
  %scrubberCapacity = 1.67
  %capsuleOrigin = US

  MODULE
  {
    name = ProcessController
    resource = _PressureControl
    title = N2 Pressure Controller
    desc = Use <b>Nitrogen</b> to maintain the internal atmosphere at a comfortable pressure.
    capacity = 1.67
    toggle = true
    running = true
  }

  MODULE
  {
    name = ProcessController
    resource = _AirPump
    title = Air Pump
    capacity = 1.2
    running = true
  }

  MODULE
  {
    name = ProcessController
    resource = _LOXConverter
    title = LOX to GOX Converter
    capacity = 0.6
    running = true
  }

  @MODULE[ProcessController],*
  {
    @capacity *= #$/CrewCapacity$
  }

  processConfigureExclude = true
  MODULE
  {
    name = Configure
    title = Processes
    slots = 3

    SETUP
    {
      name = Air Pump
      desc = Pumps external atmosphere into the cabin to maintan internal pressure. Only works in breathable atmospheres
      tech = crewSurvivability

      MODULE
      {
        type = ProcessController
        id_field = resource
        id_value = _AirPump
      }
    }
    SETUP
    {
      name = N2 Pressure Control
      desc = Use <b>Nitrogen</b> to maintain the internal atmosphere at a comfortable pressure.
      tech = earlyLifeSupport

      MODULE
      {
        type = ProcessController
        id_field = resource
        id_value = _PressureControl
      }
    }
    SETUP
    {
      name = LOX to GOX Converter
      desc = Heats <b>LqdOxygen</b> to breathable <b>Oxygen</b>.
      tech = earlyLifeSupport

      MODULE
      {
        type = ProcessController
        id_field = resource
        id_value = _LOXConverter
      }
    }
  }
}

//Switch so Buran gets Potassium Superoxide scrubbers
@PART[BURAN_CABINE]:NEEDS[ProfileRealismOverhaul]:AFTER[RealismOverhaul]
{
  @capsuleOrigin = USSR
}

//Add fuel cells to Mk3 here instead
@PART[mk3Cockpit_Shuttle]:NEEDS[ProfileRealismOverhaul]:AFTER[RealismOverhaul]
{
  MODULE
  {
    name = ProcessController
    resource = _FuelCell
    title = Fuel Cell
    capacity = 21 //https://science.ksc.nasa.gov/shuttle/technology/sts-newsref/sts-eps.html (21 kW continuous power)
    running = false
  }

  @MODULE[Configure]
  {
    @slots += 1
    SETUP
    {
      name = Fuel Cell
      desc = A fuel cell that combines <b>Liquid Hydrogen</b> and <b>Liquid Oxygen</b>, producing <b>Water</b> as a by-product.
      tech = maturePower

      MODULE
      {
        type = ProcessController
        id_field = resource
        id_value = _FuelCell
      }
    }
  }
}

//Commercial Crew Program
@PART[ROC-CSTCM]:NEEDS[ProfileRealismOverhaul]:AFTER[RealismOverhaul]
{
  %capsuleScrubbers = true
  %scrubberCapacity = 2
  %capsuleOrigin = US

  @MODULE[ModuleCommand]
  {
    @RESOURCE[ElectricCharge]
    {
      @rate = 0.600  //Remove Climatization and LS power draw
    }
  }

  MODULE
  {
    name = ProcessController
    resource = _PressureControl
    title = N2 Pressure Controller
    desc = Use <b>Nitrogen</b> to maintain the internal atmosphere at a comfortable pressure.
    capacity = 2
    toggle = true
    running = true
  }

  @MODULE[ProcessController],*
  {
    @capacity *= #$/CrewCapacity$
  }
}

//Orion
@PART[XOrionPodX|SSTU-SC-C-CM|SSTU-SC-C-CMX|ROC-OrionCM]:NEEDS[ProfileRealismOverhaul]:AFTER[RealismOverhaul]
{
  %capsuleScrubbers = true
  %scrubberCapacity = 1.67
  %capsuleOrigin = US

  @MODULE[ModuleCommand]
  {
    @RESOURCE[ElectricCharge]
    {
      @rate = 1.000  //Remove Climatization and LS power draw
    }
  }

  MODULE
  {
    name = ProcessController
    resource = _PressureControl
    title = N2 Pressure Controller
    desc = Use <b>Nitrogen</b> to maintain the internal atmosphere at a comfortable pressure.
    capacity = 1.67
    toggle = true
    running = true
  }

  @MODULE[ProcessController],*
  {
    @capacity *= #$/CrewCapacity$
  }
}

// ==============================================================================
// Habitats
// ==============================================================================
//X-15
@PART[KerbCan|RO-Mk1CrewModule]:NEEDS[ProfileRealismOverhaul]:AFTER[RealismOverhaul]
{
  %capsuleScrubbers = true
  %scrubberCapacity = 1.2
  %capsuleOrigin = US
}
//Early Space Stations
@PART[SXTCrewCabSSP20|SXTCrewCabSSP10|FASAGeminiMOLSci|L25mSci]:NEEDS[ProfileRealismOverhaul]:AFTER[RealismOverhaul]
{
  %capsuleScrubbers = true
  %scrubberCapacity = 1.67

  MODULE
  {
    name = ProcessController
    resource = _PressureControlOxygen
    title = O2 Pressure Controller
    desc = Use <b>Oxygen</b> to maintain the internal atmosphere at a comfortable pressure.
    capacity = 1.67
    toggle = true
    running = true
  }

  @MODULE[ProcessController],*
  {
    @capacity *= #$/CrewCapacity$
  }
}
//Skylab
@PART[SXTISSHabISK30|crewCabin|Large_Crewed_Lab|SXTSPKTRCabin|skylab]:NEEDS[ProfileRealismOverhaul]:AFTER[RealismOverhaul]
{
  %capsuleScrubbers = true
  %scrubberCapacity = 1.67

  MODULE
  {
    name = ProcessController
    resource = _PressureControl
    title = N2 Pressure Controller
    desc = Use <b>Nitrogen</b> to maintain the internal atmosphere at a comfortable pressure.
    capacity = 1.67
    toggle = true
    running = true
  }

  @MODULE[ProcessController],*
  {
    @capacity *= #$/CrewCapacity$
  }
}
//ISS
@PART[STXCANIOT|CXA_ELM_MiniLab|CXA_GymHab|CXA_Kibo_Lab|CXA_NapHabV1|CXA_SleepHabV4-1|CXA_SleepHabV4-2|CXA_SleepHabV6-1|CXA_SleepHabV6-2|CXA_Node1]:NEEDS[ProfileRealismOverhaul]:AFTER[RealismOverhaul]
{
  %capsuleScrubbers = true
  %scrubberCapacity = 2

  MODULE
  {
    name = ProcessController
    resource = _PressureControl
    title = N2 Pressure Controller
    desc = Use <b>Nitrogen</b> to maintain the internal atmosphere at a comfortable pressure.
    capacity = 3
    toggle = true
    running = true
  }

  @MODULE[ProcessController],*
  {
    @capacity *= #$/CrewCapacity$
  }
}

//Near future, completely configurable for surface bases and advanced space stations
@PART[InflatableHAB|SXTDLK83EHabitat]:NEEDS[ProfileRealismOverhaul]:AFTER[RealismOverhaul]
{
  %capsuleScrubbers = true
  %scrubberCapacity = 1.67

  MODULE
  {
    name = ProcessController
    resource = _PressureControl
    title = N2 Pressure Controller
    capacity = 2
    running = true
  }
  MODULE
  {
    name = ProcessController
    resource = _PressureControlOxygen
    title = O2 Pressure Controller
    capacity = 2
    running = true
  }
  MODULE
  {
    name = ProcessController
    resource = _AirPump
    title = Air Pump
    capacity = 3
    running = true
  }
  MODULE
  {
    name = ProcessController
    resource = _WaterRecycler
    title = Water Recycler
    capacity = 1.67
    running = true
  }
  MODULE
  {
    name = ProcessController
    resource = _LOXConverter
    title = LOX to GOX Converter
    capacity = 1.67
    running = true
  }

  @MODULE[ProcessController],*
  {
    @capacity *= #$/CrewCapacity$
  }

  processConfigureExclude = true
  MODULE
  {
    name = Configure
    title = Life Support
    slots = 1

    SETUP
    {
      name = None
      desc = Empty slot for mass and cost savings.
    }
    SETUP
    {
      name = N2 Pressure Control
      desc = Use <b>Nitrogen</b> to maintain the internal atmosphere at a comfortable pressure.
      tech = earlyLifeSupport
      mass = 0.05 //FIXME
      cost = 25 //FIXME

      MODULE
      {
        type = ProcessController
        id_field = resource
        id_value = _PressureControl
      }
    }

    SETUP
    {
      name = O2 Pressure Control
      desc = Use <b>Oxygen</b> to maintain the internal atmosphere at a comfortable pressure.
      tech = earlyLifeSupport
      mass = 0.01 //FIXME
      cost = 25 //FIXME

      MODULE
      {
        type = ProcessController
        id_field = resource
        id_value = _PressureControlOxygen
      }
    }

    SETUP
    {
      name = Air Pump
      desc = Pumps external atmosphere into the cabin to maintan internal pressure. Only works in breathable atmospheres
      tech = crewSurvivability
      mass = 0.02 //FIXME
      cost = 5 //FIXME

      MODULE
      {
        type = ProcessController
        id_field = resource
        id_value = _AirPump
      }
    }

    SETUP
    {
      name = Water Recycler
      desc = Filter impurities out of <b>WasteWater</b>.
      tech = advancedLifeSupport
      mass = 0.57 //  Using ISS urine processing system since that's our only wastewater generator, 742kg for 4 crew
      cost = 50 //FIXME

      MODULE
      {
        type = ProcessController
        id_field = resource
        id_value = _WaterRecycler
      }
    }

    SETUP
    {
      name = LOX to GOX Converter
      desc = Heats <b>LqdOxygen</b> to breathable <b>Oxygen</b>.
      tech = earlyLifeSupport
      mass = 0.005 //FIXME
      cost = 20 //FIXME

      MODULE
      {
        type = ProcessController
        id_field = resource
        id_value = _LOXConverter
      }
    }
  }
}

// ==============================================================================
// Add scrubber configuration to tagged parts
// ==============================================================================
@PART[*]:HAS[#capsuleScrubbers[true],#scrubberCapacity[*],#capsuleOrigin[US]]:NEEDS[ProfileRealismOverhaul]:FOR[zzzKerbalism]
{
  MODULE
  {
    name = ProcessController
    resource = _NonRegenScrubber
    title = Non Regen LiOH Scrubber
    toggle = true
    running = true
    capacity = 1.1
    @capacity *= #$/CrewCapacity$
  }

  // delete the country tag
  !capsuleOrigin = delete
}
@PART[*]:HAS[#capsuleScrubbers[true],#scrubberCapacity[*],#capsuleOrigin[USSR]]:NEEDS[ProfileRealismOverhaul]:FOR[zzzKerbalism]
{
  MODULE
  {
    name = ProcessController
    resource = _KO2Scrubber
    title = KO2 Scrubber
    toggle = true
    running = true
    capacity = #$/scrubberCapacity$
    @capacity *= #$/CrewCapacity$
  }

  // delete the country tag
  !capsuleOrigin = delete
}
@PART[*]:HAS[#capsuleScrubbers[true],#scrubberCapacity[*]]:NEEDS[ProfileRealismOverhaul]:FOR[zzzKerbalism]
{
  MODULE
  {
    name = ProcessController
    resource = _Scrubber
    title = LiOH Scrubber
    toggle = true
    running = true
    capacity = #$/scrubberCapacity$
    @capacity *= #$/CrewCapacity$
  }

  MODULE
  {
    name = ProcessController
    resource = _VacScrubber
    title = Vac Scrubber
    toggle = true
    running = true
    capacity = #$/scrubberCapacity$
    @capacity *= #$/CrewCapacity$
  }

  MODULE
  {
    name = ProcessController
    resource = _AdvScrubber
    title = Adv Vac Scrubber
    toggle = true
    running = true
    capacity = #$/scrubberCapacity$
    @capacity *= #$/CrewCapacity$
  }
}

// delete the tags in a separate patch since KSP processes values before nodes
@PART[*]:HAS[#scrubberCapacity[*]]:NEEDS[ProfileRealismOverhaul]:LAST[zzzKerbalism]
{
  !scrubberCapacity = delete
}

// ==============================================================================
// Add scrubber configuration to tagged parts
// ==============================================================================
// first, add the configure module
@PART[*]:HAS[#capsuleScrubbers[true]]:NEEDS[ProfileRealismOverhaul]:FOR[zzzKerbalism]
{
  MODULE
  {
    name = Configure
    title = Scrubber
    slots = 1
  }
}

// then, add a setup for each type of scrubber in the part
// ordered so that you (should) get the highest tech node first, and the KO2 scrubber first if you're soviet
@PART[*]:HAS[#capsuleScrubbers[true],@MODULE[ProcessController]:HAS[#resource[_AdvScrubber]]]:NEEDS[ProfileRealismOverhaul]:FOR[zzzKerbalism]
{
  @MODULE[Configure]:HAS[#title[Scrubber]]
  {
    SETUP
    {
      name = Advanced Vacuum Scrubber
      desc = A dual-bed vacuum-exposing regenerative scrubber that sequesters <b>CarbonDioxide</b> from the internal atmosphere. Can work indefinitely. Tip: use Water Electrolysis to produce O2.
      tech = improvedLifeSupport
            
      MODULE
      {
        type = ProcessController
        id_field = resource
        id_value = _AdvScrubber
      }
    }
  }
}
@PART[*]:HAS[#capsuleScrubbers[true],@MODULE[ProcessController]:HAS[#resource[_VacScrubber]]]:NEEDS[ProfileRealismOverhaul]:FOR[zzzKerbalism]
{
  @MODULE[Configure]:HAS[#title[Scrubber]]
  {
    SETUP
    {
      name = Vacuum Scrubber
      desc = A dual-bed vacuum-exposing regenerative scrubber that sequesters <b>CarbonDioxide</b> from the internal atmosphere. Can work indefinitely.
      tech = basicLifeSupport
            
      MODULE
      {
        type = ProcessController
        id_field = resource
        id_value = _VacScrubber
      }
    }
  }
}
@PART[*]:HAS[#capsuleScrubbers[true],@MODULE[ProcessController]:HAS[#resource[_KO2Scrubber]]]:NEEDS[ProfileRealismOverhaul]:FOR[zzzKerbalism]
{
  @MODULE[Configure]:HAS[#title[Scrubber]]
  {
    SETUP
    {
      name = KO2 Scrubber
      desc = A Soviet Potassium superoxide scrubber that absorbs <b>CarbonDioxide</b> from the internal atmosphere and generates <b>Oxygen</b> for the crew.
      tech = crewSurvivability
            
      MODULE
      {
        type = ProcessController
        id_field = resource
        id_value = _KO2Scrubber
      }
    }
  }
}
@PART[*]:HAS[#capsuleScrubbers[true],@MODULE[ProcessController]:HAS[#resource[_Scrubber]]]:NEEDS[ProfileRealismOverhaul]:FOR[zzzKerbalism]
{
  @MODULE[Configure]:HAS[#title[Scrubber]]
  {
    SETUP
    {
      name = LiOH Scrubber
      desc = A Lithium Hydroxide scrubber that sequesters <b>CarbonDioxide</b> from the internal atmosphere. Its operational life <b>can</b> be increased by adding additional LiOH tanks.
      tech = earlyLifeSupport
            
      MODULE
      {
        type = ProcessController
        id_field = resource
        id_value = _Scrubber
      }
    }
  }
}
@PART[*]:HAS[#capsuleScrubbers[true],@MODULE[ProcessController]:HAS[#resource[_NonRegenScrubber]]]:NEEDS[ProfileRealismOverhaul]:FOR[zzzKerbalism]
{
  @MODULE[Configure]:HAS[#title[Scrubber]]
  {
    SETUP
    {
      name = LiOH scrubber (2d)
      desc = A <b>Lithium Hydroxide</b> scrubber that sequesters <b>CarbonDioxide</b> from the internal atmosphere. <b>WARNING: Only lasts 2 days!</b> Research next life support nodes to unlock better options.
      tech = crewSurvivability
            
      MODULE
      {
        type = ProcessController
        id_field = resource
        id_value = _NonRegenScrubber
      }
    }
  }
}

// finally, delete the tag
@PART[*]:HAS[#capsuleScrubbers[*]]:NEEDS[ProfileRealismOverhaul]:LAST[zzzKerbalism]
{
  !capsuleScrubbers = delete
}

// ==============================================================================
// Add generic configure module to parts without the exclude tag
// ==============================================================================
// first add the module
@PART[*]:HAS[~processConfigureExclude[true],@MODULE[ProcessController]:HAS[#resource[_LOXConverter]],!MODULE[Configure]:HAS[#title[Processes]]]:NEEDS[ProfileRealismOverhaul]:BEFORE[zzzKerbalism]
{
  MODULE
  {
    name = Configure
    title = Processes
    slots = 0
  }
}
@PART[*]:HAS[~processConfigureExclude[true],@MODULE[ProcessController]:HAS[#resource[_PressureControl]],!MODULE[Configure]:HAS[#title[Processes]]]:NEEDS[ProfileRealismOverhaul]:BEFORE[zzzKerbalism]
{
  MODULE
  {
    name = Configure
    title = Processes
    slots = 0
  }
}
@PART[*]:HAS[~processConfigureExclude[true],@MODULE[ProcessController]:HAS[#resource[_PressureControlOxygen]],!MODULE[Configure]:HAS[#title[Processes]]]:NEEDS[ProfileRealismOverhaul]:BEFORE[zzzKerbalism]
{
  MODULE
  {
    name = Configure
    title = Processes
    slots = 0
  }
}
@PART[*]:HAS[~processConfigureExclude[true],@MODULE[ProcessController]:HAS[#resource[_AirPump]],!MODULE[Configure]:HAS[#title[Processes]]]:NEEDS[ProfileRealismOverhaul]:BEFORE[zzzKerbalism]
{
  MODULE
  {
    name = Configure
    title = Processes
    slots = 0
  }
}
@PART[*]:HAS[~processConfigureExclude[true],@MODULE[ProcessController]:HAS[#resource[_WaterRecycler]],!MODULE[Configure]:HAS[#title[Processes]]]:NEEDS[ProfileRealismOverhaul]:BEFORE[zzzKerbalism]
{
  MODULE
  {
    name = Configure
    title = Processes
    slots = 0
  }
}

// then add the slots
@PART[*]:HAS[~processConfigureExclude[true],@MODULE[ProcessController]:HAS[#resource[_LOXConverter]],@MODULE[Configure]:HAS[#title[Processes]]]:NEEDS[ProfileRealismOverhaul]:FOR[zzzKerbalism]
{
  @MODULE[Configure]:HAS[#title[Processes]]
  {
    @slots += 1
    SETUP
    {
      name = LOX to GOX Converter
      desc = Heats <b>LqdOxygen</b> to breathable <b>Oxygen</b>.
      tech = earlyLifeSupport
      MODULE
      {
        type = ProcessController
        id_field = resource
        id_value = _LOXConverter
      }
    }
  }
}
@PART[*]:HAS[~processConfigureExclude[true],@MODULE[ProcessController]:HAS[#resource[_PressureControl]],@MODULE[Configure]:HAS[#title[Processes]]]:NEEDS[ProfileRealismOverhaul]:FOR[zzzKerbalism]
{
  @MODULE[Configure]:HAS[#title[Processes]]
  {
    @slots += 1
    SETUP
    {
      name = N2 Pressure Control
      desc = Use <b>Nitrogen</b> to maintain the internal atmosphere at a comfortable pressure.
      tech = earlyLifeSupport
      MODULE
      {
        type = ProcessController
        id_field = resource
        id_value = _PressureControl
      }
    }
  }
}
@PART[*]:HAS[~processConfigureExclude[true],@MODULE[ProcessController]:HAS[#resource[_PressureControlOxygen]],@MODULE[Configure]:HAS[#title[Processes]]]:NEEDS[ProfileRealismOverhaul]:FOR[zzzKerbalism]
{
  @MODULE[Configure]:HAS[#title[Processes]]
  {
    @slots += 1
    SETUP
    {
      name = O2 Pressure Controller
      desc = Use <b>Oxygen</b> to maintain the internal atmosphere at a comfortable pressure.
      tech = crewSurvivability
      MODULE
      {
        type = ProcessController
        id_field = resource
        id_value = _PressureControlOxygen
      }
    }
  }
}
@PART[*]:HAS[~processConfigureExclude[true],@MODULE[ProcessController]:HAS[#resource[_AirPump]],@MODULE[Configure]:HAS[#title[Processes]]]:NEEDS[ProfileRealismOverhaul]:FOR[zzzKerbalism]
{
  @MODULE[Configure]:HAS[#title[Processes]]
  {
    @slots += 1
    SETUP
    {
      name = Air Pump
      desc = Pumps external atmosphere into the cabin to maintan internal pressure. Only works in breathable atmospheres
      tech = crewSurvivability
      MODULE
      {
        type = ProcessController
        id_field = resource
        id_value = _AirPump
      }
    }
  }
}
@PART[*]:HAS[~processConfigureExclude[true],@MODULE[ProcessController]:HAS[#resource[_WaterRecycler]],@MODULE[Configure]:HAS[#title[Processes]]]:NEEDS[ProfileRealismOverhaul]:FOR[zzzKerbalism]
{
  @MODULE[Configure]:HAS[#title[Processes]]
  {
    @slots += 1
    SETUP
    {
      name = Water Recycler
      desc = Filter impurities out of <b>WasteWater</b>.
      tech = advancedLifeSupport
      MODULE
      {
        type = ProcessController
        id_field = resource
        id_value = _WaterRecycler
      }
    }
  }
}

// delete the tag
@PART[*]:HAS[#processConfigureExclude[*]]:NEEDS[ProfileRealismOverhaul]:LAST[zzzKerbalism]
{
  !processConfigureExclude = delete
}

// ==============================================================================
// Remove unnecessary stock modules and resources
// ==============================================================================
@PART[ROC-ApolloSM]:NEEDS[ProfileRealismOverhaul]:AFTER[RealismOverhaul]
{
  !MODULE[ModuleResourceConverter] {}
  !MODULE[ModuleResourceConverter] {}
  !MODULE[ModuleResourceConverter] {}
}

// ==============================================================================
// Remove unused parts
// ==============================================================================
!PART[kerbalism-container-inline-0625] {}
!PART[kerbalism-container-inline-125] {}
!PART[kerbalism-container-inline-250] {}
!PART[kerbalism-container-inline-375] {}
!PART[kerbalism-container-radial-small] {}
!PART[kerbalism-container-radial-medium] {}
!PART[kerbalism-container-radial-big] {}
!PART[kerbalism-container-radial-huge] {}
!PART[kerbalism-greenhouse] {}
!PART[kerbalism-gravityring] {}
!PART[kerbalism-geigercounter] {}
!PART[kerbalism-antenna] {}
